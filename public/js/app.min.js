function isset(e){return e!==void 0&&null!==e}function Ajax(e,t){this.post=[],this.elm=void 0,this.loader=void 0,e&&(this.elm=e,this.loader=document.createElement("span"),this.loader.className="loading",this.loader.innerHTML='<i class="n1"></i><i class="n2"></i><i class="n3"></i>',this.elm.parentNode.replaceChild(this.loader,this.elm)),this.post.push("action="+t),this.post.push("page="+page),this.addParam=function(e,t){this.post.push(e+"="+encodeURIComponent(t))},this.send=function(e,t){var n=this,o=new XMLHttpRequest;o.open("POST",ajax_url),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(this.post.join("&")),o.onreadystatechange=function(){if(o.readyState==o.DONE){if(200==o.status){console.log(o.responseText);var a=JSON.parse(o.responseText);"success"==a.status?e!==void 0&&e(a):t!==void 0&&t(a)}else 403==o.status?alert(m_error_login):alert(m_error_ajax);n.cancel()}}},this.cancel=function(){this.loader&&this.loader.parentNode.replaceChild(this.elm,this.loader)}}function desc_episode(e){for(var t=document.querySelectorAll(".div-episode"),n=t.length-1;n>=0;n--)t[n].style.display="none";return document.getElementById(e.target.dataset.no).style.display="block",!1}function episode_watched(e){var t=e.target,n=t.dataset.no,o=new Ajax(void 0,"watched");return o.addParam("id",t.dataset.id),o.addParam("no",n),o.send(function(){var e=document.getElementById("a"+n),t=document.getElementById(n),o="watched";if("watched"==e.className){var a=t.querySelector(".span-date").textContent,s=new Date,i=s.getFullYear()+"-"+("0"+(s.getMonth()+1)).slice(-2)+"-"+("0"+s.getDate()).slice(-2);o=i>a&&""!==a?"released":""}e.className=o,t.className="div-episode "+o}),!1}function season_watched(e){var t=e.target,n=t.dataset.s,o=new Ajax(void 0,"swatched");o.addParam("snb",n),o.addParam("id",t.dataset.id),o.send(function(){document.location.reload()})}function onload_tags(){function e(){for(var e=s.querySelectorAll(".tag"),t=[],n=0;e.length>n;n++)t.push(e[n].innerHTML);l.value=t.join(",")}function t(t){return t.target.parentNode.removeChild(t.target),e(),!1}function n(e){var n=document.createElement("a");n.href="#",n.className="tag",n.innerHTML=e,i.appendChild(n),n.onclick=t}function o(){""!==d.value&&(n(d.value),d.value="",e())}function a(){if(""!==l.value)for(var e=l.value.split(/,/),t=0;e.length>t;t++)n(e[t])}var s=document.querySelector(".editTags"),i=s.querySelector("span"),l=document.getElementById("tags"),d=document.getElementById("addTag"),r=document.querySelector(".pick-tag"),c=r.querySelectorAll("span"),u=!1;r.onmousedown=function(e){"visible"==e.target.className&&(d.value=e.target.innerHTML,o(),u=!0)},d.onkeydown=function(e){if("keyCode"in e&&(13==e.keyCode||188==e.keyCode)||"key"in e&&("Enter"==e.key||","==e.key))return o(),d.blur(),d.focus(),!1;if("keyCode"in e&&9==e.keyCode||"key"in e&&"Tab"==e.key){var t=form.list.querySelector(".visible");return null!==t&&(d.value=t.innerHTML,o(),d.blur(),d.focus()),!1}},d.onfocus=function(){var e=d.getBoundingClientRect();r.style.left=e.left+"px",r.style.top=e.bottom+"px",d.onkeyup()},d.onblur=function(){u?(u=!1,setTimeout("document.getElementById('addTag').focus()",10)):(r.style.left="-9999px",r.style.top="-9999px")},d.onkeyup=function(){for(var e=d.value,t=0;c.length>t;t++)c[t].className=-1===c[t].innerHTML.indexOf(e)?"":"visible"},l.onupdate=a,a()}isset(document.getElementById("logout"))&&(document.getElementById("logout").onclick=function(){return document.getElementById("form-logout").submit(),!1}),isset(document.getElementById("series"))&&(document.getElementById("series").onclick=function(){return document.getElementById("nav").className="display-series",!1}),isset(document.getElementById("back"))&&(document.getElementById("back").onclick=function(){return document.getElementById("nav").className="",!1});for(var a_episode=document.querySelectorAll(".ul-episodes a"),i=a_episode.length-1;i>=0;i--)a_episode[i].onclick=desc_episode;a_episode=document.querySelectorAll(".div-episode a");for(var i=a_episode.length-1;i>=0;i--)a_episode[i].onclick=episode_watched;for(var a_season=document.querySelectorAll(".a-season"),i=a_season.length-1;i>=0;i--)a_season[i].onclick=season_watched;isset(document.querySelector(".editTags"))&&onload_tags();